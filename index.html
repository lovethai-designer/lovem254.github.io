<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loveth AI Designer</title>
    <!-- Tailwind CSS from CDN for easy deployment -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- MathJax for LaTeX Rendering -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.js"></script>
    <!-- Firebase SDK and all application logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables for Firebase services
        window.firebaseApp = null;
        window.auth = null;
        window.db = null;
        window.userId = null;
        window.isAuthReady = false;
        
        // Use provided global variables
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Function to initialize Firebase
        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    window.firebaseApp = initializeApp(firebaseConfig);
                    window.db = getFirestore(window.firebaseApp);
                    window.auth = getAuth(window.firebaseApp);

                    onAuthStateChanged(window.auth, async (user) => {
                        if (user) {
                            window.userId = user.uid;
                            document.getElementById('user-id-display').textContent = `User ID: ${window.userId}`;
                            document.getElementById('project-path-display').textContent = `Project Path: /artifacts/${appId}/users/${window.userId}/projects/loveth_designer`;
                        } else {
                            window.userId = null;
                            document.getElementById('user-id-display').textContent = 'User ID: Not authenticated';
                            document.getElementById('project-path-display').textContent = 'Project Path: N/A';
                        }
                        window.isAuthReady = true;
                    });

                    if (initialAuthToken) {
                        await signInWithCustomToken(window.auth, initialAuthToken);
                    } else {
                        await signInAnonymously(window.auth);
                    }
                } else {
                    console.error("Firebase config is missing.");
                    window.isAuthReady = true;
                }
            } catch (e) {
                console.error("Error initializing Firebase:", e);
                window.isAuthReady = true;
            }
        }
        initializeFirebase();
        
        // --- All application logic now resides within this module script ---
        
        const apiKey = ""; // The API key is not required here, it is provided by the environment
        const tabs = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        const loadingOverlay = document.getElementById('loading-overlay');
        let currentSVG = null;

        // Ensure MathJax is loaded before use
        let mathJaxReady = false;
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            startup: {
                pageReady: () => {
                    mathJaxReady = true;
                }
            }
        };

        window.showMessage = function(title, message) {
            const modalContainer = document.getElementById('modal-container');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').textContent = message;
            modalContainer.classList.remove('hidden');
        }

        window.hideModal = function() {
            const modalContainer = document.getElementById('modal-container');
            modalContainer.classList.add('hidden');
        }

        function showLoading() {
            loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            loadingOverlay.classList.add('hidden');
        }

        window.onload = function() {
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.id.replace('tab-', '');
                    tabs.forEach(t => t.classList.remove('active-tab-bg', 'bg-gray-100'));
                    tab.classList.add('active-tab-bg', 'bg-gray-100');
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(targetTab + '-content').classList.add('active');
                });
            });
            document.getElementById('tab-render').classList.add('active-tab-bg', 'bg-gray-100');

            document.getElementById('render-button').addEventListener('click', generateRender);
            document.getElementById('design-button').addEventListener('click', generateDesign);
            document.getElementById('structural-button').addEventListener('click', performStructuralAnalysis);
            document.getElementById('download-pdf-button').addEventListener('click', downloadPDF);
        };
        
        window.previewRenderImage = function() {
            const fileInput = document.getElementById('render-image');
            const previewImage = document.getElementById('render-preview-image');
            const placeholderText = document.getElementById('render-placeholder-text');
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    previewImage.classList.remove('hidden');
                    placeholderText.classList.add('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                previewImage.classList.add('hidden');
                placeholderText.classList.remove('hidden');
            }
        }

        async function fetchWithRetry(url, payload, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) {
                        return response;
                    } else if (response.status === 429) {
                        console.warn(`Rate limit exceeded. Retrying in ${delay / 1000} seconds...`);
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2; // Exponential backoff
                    } else {
                        throw new Error(`API responded with status: ${response.status}`);
                    }
                } catch (error) {
                    if (i === retries - 1) {
                        throw error;
                    }
                    console.error(`Fetch failed. Retrying in ${delay / 1000} seconds...`, error);
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2;
                }
            }
            throw new Error("Failed to fetch after multiple retries.");
        }

        async function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        async function generateRender() {
            const prompt = document.getElementById('render-prompt').value;
            const imageFile = document.getElementById('render-image').files[0];
            const outputContainer = document.getElementById('render-output');
            outputContainer.innerHTML = '<span class="text-gray-500 italic">Generating...</span>';
            showLoading();

            const payload = {
                contents: [{
                    parts: [{ text: `Generate a photorealistic architectural render based on the following prompt: ${prompt}.` }]
                }],
                generationConfig: {
                    responseModalities: ['TEXT', 'IMAGE']
                }
            };

            if (imageFile) {
                const base64Image = await fileToBase64(imageFile);
                payload.contents[0].parts.push({
                    inlineData: {
                        mimeType: imageFile.type,
                        data: base64Image
                    }
                });
            }

            const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=" + apiKey;

            try {
                const response = await fetchWithRetry(apiUrl, { instances: { prompt: prompt }, parameters: { "sampleCount": 1} });
                const result = await response.json();
                const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;
                
                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    outputContainer.innerHTML = `<img src="${imageUrl}" alt="AI Generated Render" class="rounded-xl shadow-lg w-full h-auto object-cover">`;
                } else {
                    const textOutput = result?.candidates?.[0]?.content?.parts?.[0]?.text || 'No image generated. Please try again with a different prompt.';
                    outputContainer.innerHTML = `<div class="p-4 bg-red-100 text-red-700 rounded-lg">${textOutput}</div>`;
                }
            } catch (error) {
                console.error("Error generating render:", error);
                outputContainer.innerHTML = `<div class="p-4 bg-red-100 text-red-700 rounded-lg">Error: ${error.message}</div>`;
            } finally {
                hideLoading();
            }
        }

        async function generateDesign() {
            const prompt = document.getElementById('design-input').value;
            const imageFile = document.getElementById('design-image').files[0];
            const outputContainer = document.getElementById('design-output');
            const downloadButton = document.getElementById('download-pdf-button');
            outputContainer.innerHTML = '<span class="text-gray-500 italic">Generating...</span>';
            downloadButton.classList.add('hidden');
            showLoading();

            const payload = {
                contents: [{
                    parts: [{ text: `Generate a 2D architectural floor plan in SVG format based on the following description: ${prompt}. Only provide the SVG code block, nothing else.` }]
                }]
            };

            if (imageFile) {
                const base64Image = await fileToBase64(imageFile);
                payload.contents[0].parts.push({
                    inlineData: {
                        mimeType: imageFile.type,
                        data: base64Image
                    }
                });
            }
            
            const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + apiKey;

            try {
                const response = await fetchWithRetry(apiUrl, payload);
                const result = await response.json();
                let svgContent = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                if (svgContent) {
                    // Extract only the SVG part
                    const svgMatch = svgContent.match(/<svg[\s\S]*?<\/svg>/);
                    if (svgMatch) {
                        svgContent = svgMatch[0];
                        outputContainer.innerHTML = svgContent;
                        currentSVG = svgContent;
                        downloadButton.classList.remove('hidden');
                    } else {
                        outputContainer.innerHTML = `<div class="p-4 bg-red-100 text-red-700 rounded-lg">Invalid SVG output received.</div>`;
                    }
                } else {
                    outputContainer.innerHTML = `<div class="p-4 bg-red-100 text-red-700 rounded-lg">No SVG content generated.</div>`;
                }
            } catch (error) {
                console.error("Error generating design:", error);
                outputContainer.innerHTML = `<div class="p-4 bg-red-100 text-red-700 rounded-lg">Error: ${error.message}</div>`;
            } finally {
                hideLoading();
            }
        }

        window.downloadPDF = function() {
            if (!currentSVG) {
                showMessage('Download Error', 'No SVG content to download.');
                return;
            }
            const doc = new jspdf.jsPDF('l', 'mm', 'a4');
            const width = doc.internal.pageSize.getWidth();
            const height = doc.internal.pageSize.getHeight();
            doc.svg(currentSVG, {
                x: 0,
                y: 0,
                width: width,
                height: height
            }).then(() => {
                doc.save('architectural_plan.pdf');
            }).catch(error => {
                console.error("Error generating PDF:", error);
                showMessage('Download Error', 'Failed to generate PDF. Please try again.');
            });
        }

        async function performStructuralAnalysis() {
            const imageFile = document.getElementById('structural-image').files[0];
            const task = document.getElementById('structural-task').value;
            const outputContainer = document.getElementById('structural-output');
            outputContainer.innerHTML = '<span class="text-gray-500 italic">Performing analysis...</span>';
            showLoading();

            if (!imageFile) {
                showMessage('Input Error', 'Please upload a structural image.');
                hideLoading();
                return;
            }

            const base64Image = await fileToBase64(imageFile);

            const payload = {
                contents: [{
                    parts: [
                        { text: `Perform a detailed structural analysis based on the image. The analysis task is ${task}. Provide the results in Markdown format, with all mathematical equations in LaTeX enclosed in $ or $$ delimiters. Be very thorough.` },
                        {
                            inlineData: {
                                mimeType: imageFile.type,
                                data: base64Image
                            }
                        }
                    ]
                }]
            };

            const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + apiKey;

            try {
                const response = await fetchWithRetry(apiUrl, payload);
                const result = await response.json();
                const analysisText = result?.candidates?.[0]?.content?.parts?.[0]?.text || 'No analysis could be performed.';

                outputContainer.innerHTML = marked.parse(analysisText);
                if (window.MathJax) {
                    window.MathJax.typesetPromise();
                }
            } catch (error) {
                console.error("Error performing structural analysis:", error);
                outputContainer.innerHTML = `<div class="p-4 bg-red-100 text-red-700 rounded-lg">Error: ${error.message}</div>`;
            } finally {
                hideLoading();
            }
        }

        window.saveProject = async function() {
            if (!window.isAuthReady) {
                showMessage('Save Error', 'Authentication is not ready. Please wait a moment.');
                return;
            }
            if (!window.userId) {
                showMessage('Save Error', 'You must be authenticated to save a project.');
                return;
            }

            const projectData = {
                title: document.title,
                client: "Loveth AI Designer",
                data: {
                    renderPrompt: document.getElementById('render-prompt').value,
                    designPrompt: document.getElementById('design-input').value,
                    structuralTask: document.getElementById('structural-task').value,
                }
            };
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const projectDocRef = doc(window.db, `artifacts/${appId}/users/${window.userId}/projects/loveth_designer`);

            try {
                await setDoc(projectDocRef, projectData, { merge: true });
                showMessage('Project Saved', 'Your project data has been successfully saved to Firestore.');
            } catch (error) {
                console.error("Error saving project:", error);
                showMessage('Save Error', `Failed to save project: ${error.message}`);
            }
        }

        window.loadProject = async function() {
            if (!window.isAuthReady) {
                showMessage('Load Error', 'Authentication is not ready. Please wait a moment.');
                return;
            }
            if (!window.userId) {
                showMessage('Load Error', 'You must be authenticated to load a project.');
                return;
            }
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const projectDocRef = doc(window.db, `artifacts/${appId}/users/${window.userId}/projects/loveth_designer`);

            try {
                const docSnap = await getDoc(projectDocRef);
                if (docSnap.exists()) {
                    const projectData = docSnap.data();
                    document.getElementById('render-prompt').value = projectData.data.renderPrompt || '';
                    document.getElementById('design-input').value = projectData.data.designPrompt || '';
                    document.getElementById('structural-task').value = projectData.data.structuralTask || 'frame-analysis';
                    showMessage('Project Loaded', 'Project data has been successfully loaded.');
                } else {
                    showMessage('Load Error', 'No saved project found for this user.');
                }
            } catch (error) {
                console.error("Error loading project:", error);
                showMessage('Load Error', `Failed to load project: ${error.message}`);
            }
        }

        window.explainAi = async function() {
            const payload = {
                contents: [
                    {
                        parts: [
                            {
                                text: "Explain how AI works in a few words"
                            }
                        ]
                    }
                ],
            };
            const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + apiKey;

            try {
                const response = await fetchWithRetry(apiUrl, payload);
                const result = await response.json();
                const explanation = result?.candidates?.[0]?.content?.parts?.[0]?.text || "Could not retrieve explanation.";
                showMessage('How AI Works', explanation);
            } catch (error) {
                console.error("Error explaining AI:", error);
                showMessage('Error', 'Failed to get an explanation. Please check the console for details.');
            }
        }

    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .loading-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #10b981;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #94a3b8;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #64748b;
        }
    </style>
</head>

<body class="flex flex-col min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-md p-4 flex items-center justify-between flex-wrap gap-4">
        <div class="flex items-center gap-4">
            <i class="fas fa-drafting-compass text-green-500 text-3xl"></i>
            <h1 class="text-3xl font-bold text-gray-800">Loveth AI Designer</h1>
        </div>
        <div class="flex items-center gap-4 text-sm text-gray-600 font-mono">
            <div>
                <span id="user-id-display" class="block"></span>
                <span id="project-path-display" class="block"></span>
            </div>
            <button onclick="saveProject()" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-full shadow-lg transition duration-300 transform hover:scale-105">
                <i class="fas fa-save mr-2"></i>Save
            </button>
            <button onclick="loadProject()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-full shadow-lg transition duration-300 transform hover:scale-105">
                <i class="fas fa-cloud-download-alt mr-2"></i>Load
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto p-4 md:p-8 flex flex-col lg:flex-row gap-8">
        <!-- Sidebar and Tabs -->
        <aside class="w-full lg:w-1/4 bg-white p-6 rounded-3xl shadow-lg flex flex-col gap-6">
            <nav class="flex flex-col gap-2">
                <button id="tab-render" class="tab-button w-full text-left p-4 rounded-xl font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 transition duration-300 active-tab-bg">
                    <i class="fas fa-image mr-3 text-lg"></i> Render Image
                </button>
                <button id="tab-design" class="tab-button w-full text-left p-4 rounded-xl font-medium text-gray-700 hover:bg-gray-200 transition duration-300">
                    <i class="fas fa-ruler-combined mr-3 text-lg"></i> Architectural Design
                </button>
                <button id="tab-structural" class="tab-button w-full text-left p-4 rounded-xl font-medium text-gray-700 hover:bg-gray-200 transition duration-300">
                    <i class="fas fa-drafting-compass mr-3 text-lg"></i> Structural Design
                </button>
            </nav>
            <div class="mt-auto pt-6 border-t border-gray-200">
                <button onclick="explainAi()" class="w-full bg-slate-500 hover:bg-slate-600 text-white font-semibold py-3 px-6 rounded-full shadow-lg transition duration-300 transform hover:scale-105">
                    <i class="fas fa-question-circle mr-2"></i> Explain AI
                </button>
            </div>
        </aside>

        <!-- Main Workspace -->
        <div class="w-full lg:w-3/4 bg-white p-6 rounded-3xl shadow-lg relative">
            <div id="loading-overlay" class="loading-container hidden">
                <div class="spinner"></div>
            </div>
            
            <!-- Render Image Tab -->
            <div id="render-content" class="tab-content active space-y-6">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">Render Image</h2>
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="w-full md:w-1/2">
                        <label for="render-image" class="block text-gray-700 font-medium mb-2">Upload Reference Image</label>
                        <input type="file" id="render-image" accept="image/*" class="w-full p-2 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-300" onchange="previewRenderImage()">
                    </div>
                    <div class="w-full md:w-1/2">
                        <label for="render-prompt" class="block text-gray-700 font-medium mb-2">Image Prompt</label>
                        <textarea id="render-prompt" rows="3" class="w-full p-3 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-300" placeholder="e.g., A minimalist living room with large windows, natural light, and a fireplace."></textarea>
                    </div>
                </div>
                <button id="render-button" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 transform hover:scale-105">
                    <i class="fas fa-magic mr-2"></i> Generate Render
                </button>
                <div id="render-output" class="mt-6 flex justify-center items-center p-6 border-2 border-dashed border-gray-300 rounded-2xl bg-gray-50">
                    <img id="render-preview-image" class="rounded-xl shadow-lg w-full h-auto object-cover hidden" alt="Uploaded Image Preview">
                    <span id="render-placeholder-text" class="text-gray-500 italic">Generated image will appear here.</span>
                </div>
            </div>

            <!-- Architectural Design Tab -->
            <div id="design-content" class="tab-content space-y-6">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">Architectural Design</h2>
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="w-full md:w-1/2">
                        <label for="design-input" class="block text-gray-700 font-medium mb-2">Design Prompt (or upload image)</label>
                        <textarea id="design-input" rows="3" class="w-full p-3 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-300" placeholder="e.g., A 3-bedroom, 2-bathroom house with an open-plan kitchen and a large living area."></textarea>
                    </div>
                    <div class="w-full md:w-1/2">
                        <label for="design-image" class="block text-gray-700 font-medium mb-2">Upload Reference Image</label>
                        <input type="file" id="design-image" accept="image/*" class="w-full p-2 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-300">
                    </div>
                </div>
                <button id="design-button" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 transform hover:scale-105">
                    <i class="fas fa-drafting-compass mr-2"></i> Generate Plan
                </button>
                <div id="design-output" class="mt-6 flex justify-center items-center p-6 border-2 border-dashed border-gray-300 rounded-2xl bg-gray-50 overflow-auto">
                    <span class="text-gray-500 italic">Generated architectural plan will appear here.</span>
                </div>
                <button id="download-pdf-button" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 transform hover:scale-105 hidden mt-4">
                    <i class="fas fa-file-pdf mr-2"></i> Download as PDF
                </button>
            </div>

            <!-- Structural Design Tab -->
            <div id="structural-content" class="tab-content space-y-6">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">Structural Design</h2>
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="w-full md:w-1/2">
                        <label for="structural-image" class="block text-gray-700 font-medium mb-2">Upload Structural Image</label>
                        <input type="file" id="structural-image" accept="image/*" class="w-full p-2 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-300">
                    </div>
                    <div class="w-full md:w-1/2">
                        <label for="structural-task" class="block text-gray-700 font-medium mb-2">Analysis Task</label>
                        <select id="structural-task" class="w-full p-3 border border-gray-300 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-300">
                            <option value="frame-analysis">Frame Analysis</option>
                            <option value="beam-design">Beam Design</option>
                            <option value="column-design">Column Design</option>
                        </select>
                    </div>
                </div>
                <button id="structural-button" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 transform hover:scale-105">
                    <i class="fas fa-cogs mr-2"></i> Perform Analysis
                </button>
                <div id="structural-output" class="mt-6 p-6 border-2 border-dashed border-gray-300 rounded-2xl bg-gray-50 font-mono text-sm overflow-auto">
                    <span class="text-gray-500 italic">Analysis results will appear here.</span>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Toast/Modal for messages -->
    <div id="message-container" class="fixed bottom-4 right-4 z-50"></div>
    <div id="modal-container" class="fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white p-6 rounded-2xl shadow-xl max-w-sm w-full space-y-4">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800"></h3>
            <p id="modal-body" class="text-gray-700"></p>
            <button onclick="hideModal()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded-full transition duration-300">Close</button>
        </div>
    </div>
</body>
</html>
